<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="initial-scale=1" name="viewport" /><title>Padrino - Padrino Cache</title><link href="../../../images/favicons/apple-touch-icon-57x57-75d6516e.png" rel="apple-touch-icon" sizes="57x57" /><link href="../../../images/favicons/apple-touch-icon-60x60-76221479.png" rel="apple-touch-icon" sizes="60x60" /><link href="../../../images/favicons/apple-touch-icon-72x72-7bd96522.png" rel="apple-touch-icon" sizes="72x72" /><link href="../../../images/favicons/apple-touch-icon-76x76-30739e4d.png" rel="apple-touch-icon" sizes="76x76" /><link href="../../../images/favicons/apple-touch-icon-114x114-1b1963ee.png" rel="apple-touch-icon" sizes="114x114" /><link href="../../../images/favicons/apple-touch-icon-144x144-b3992622.png" rel="apple-touch-icon" sizes="144x144" /><link href="../../../images/favicons/apple-touch-icon-152x152-48259d13.png" rel="apple-touch-icon" sizes="152x152" /><link href="../../../images/favicons/apple-touch-icon-180x180-b8e9ebf6.png" rel="apple-touch-icon" sizes="180x180" /><link href="../../../images/favicons/favicon-32x32-c7d41b6f.png" rel="icon" sizes="32x32" type="image/png" /><link href="../../../images/favicons/favicon-194x194-a2b53f7f.png" rel="icon" sizes="194x194" type="image/png" /><link href="../../../images/favicons/favicon-96x96-1f5cec29.png" rel="icon" sizes="96x96" type="image/png" /><link href="../../../images/favicons/android-chrome-192x192-a15741d5.png" rel="icon" sizes="192x192" type="image/png" /><link href="../../../images/favicons/favicon-16x16-609a9b93.png" rel="icon" sizes="16x16" type="image/png" /><link href="/images/favicons/manifest.json" rel="manifest" /><link color="#5bbad5" href="../../../images/favicons/safari-pinned-tab-a188e924.svg" rel="mask-icon" /><link href="../../../images/favicons/favicon.ico" rel="shortcut icon" /><meta content="#da532c" name="msapplication-TileColor" /><meta content="../../../images/favicons/mstile-144x144-c2018144.png" name="msapplication-TileImage" /><meta content="/images/favicons/browserconfig.xml" name="msapplication-config" /><meta content="#ffffff" name="theme-color" /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" /><link href="../../../assets/stylesheets/all-2fbb5fe1.css" rel="stylesheet" /><script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script><script src="../../../assets/javascripts/all-956a861e.js"></script><link href="http://padrinorb.com/blog.rss" rel="alternate" title="Blog - Padrino Ruby Web Framework" type="application/rss+xml" /></head><body class="guides guides_03_features guides_03_features_04_padrino-cache guides_03_features_04_padrino-cache_index"><div class="grid"><header class="header"><h1 class="header__name"><a href="/" class="padrino-name">Padrino</a></h1><div class="header__navigation"><nav class="navigation"><a class="navigation__toggler" href="#" id="navigation__toggler"><span class="navigation__toggler__icon fa fa-navicon"></span></a><ul class="navigation__items" id="navigation__items"><li class="navigation__item"><a href="/" class="navigation__link">Overview</a></li><li class="navigation__item"><a href="/guides/" class="navigation__link--is-active">Guides</a></li><li class="navigation__item"><a href="/blog/" class="navigation__link">Blog</a></li><li class="navigation__item"><a href="http://www.rubydoc.info/github/padrino/padrino-framework" class="navigation__link">API</a></li><li class="navigation__item"><a href="/contribute/" class="navigation__link">Contribute</a></li><li class="navigation__item"><a href="https://github.com/padrino/padrino-framework" class="navigation__link"><span class="button--slim">GitHub</span></a></li></ul></nav></div></header><div class="page"><div class="page__sidebar"><div class="sidebar"><h4 class="sidebar__header--first">Guides</h4><h5 class="sidebar__header"><a href="/guides/introduction/overview/">Introduction</a></h5><ul class="sidebar__items"><li class="sidebar__item"><a href="/guides/introduction/overview/" class="sidebar__link">Overview</a></li><li class="sidebar__item"><a href="/guides/introduction/why-learn-padrino/" class="sidebar__link">Why Learn Padrino?</a></li><li class="sidebar__item"><a href="/guides/introduction/examples/" class="sidebar__link">Examples</a></li><li class="sidebar__item"><a href="/guides/introduction/the-bleeding-edge/" class="sidebar__link">The Bleeding Edge</a></li><li class="sidebar__item"><a href="/guides/introduction/press/" class="sidebar__link">Press</a></li></ul><h5 class="sidebar__header"><a href="/guides/getting-started/overview/">Getting Started</a></h5><ul class="sidebar__items"><li class="sidebar__item"><a href="/guides/getting-started/overview/" class="sidebar__link">Overview</a></li><li class="sidebar__item"><a href="/guides/getting-started/basic-projects/" class="sidebar__link">Basic Projects</a></li><li class="sidebar__item"><a href="/guides/getting-started/installation/" class="sidebar__link">Installation</a></li><li class="sidebar__item"><a href="/guides/getting-started/blog-tutorial/" class="sidebar__link">Blog Tutorial</a></li></ul><h5 class="sidebar__header"><a href="/guides/features/overview/">Features</a></h5><ul class="sidebar__items"><li class="sidebar__item"><a href="/guides/features/overview/" class="sidebar__link">Overview</a></li><li class="sidebar__item"><a href="/guides/features/padrino-admin/" class="sidebar__link">Padrino Admin</a></li><li class="sidebar__item"><a href="/guides/features/padrino-mailer/" class="sidebar__link">Padrino Mailer</a></li><li class="sidebar__item"><a href="/guides/features/padrino-cache/" class="sidebar__link">Padrino Cache</a></li><li class="sidebar__item"><a href="/guides/features/mounting-applications/" class="sidebar__link">Mounting Applications</a></li><li class="sidebar__item"><a href="/guides/features/development-commands/" class="sidebar__link">Development Commands</a></li><li class="sidebar__item"><a href="/guides/features/extensions/" class="sidebar__link">Extensions</a></li><li class="sidebar__item"><a href="/guides/features/localization/" class="sidebar__link">Localization</a></li><li class="sidebar__item"><a href="/guides/features/rake-tasks/" class="sidebar__link">Rake Tasks</a></li></ul><h5 class="sidebar__header"><a href="/guides/generators/overview/">Generators</a></h5><ul class="sidebar__items"><li class="sidebar__item"><a href="/guides/generators/overview/" class="sidebar__link">Overview</a></li><li class="sidebar__item"><a href="/guides/generators/projects/" class="sidebar__link">Projects</a></li><li class="sidebar__item"><a href="/guides/generators/plugins/" class="sidebar__link">Plugins</a></li><li class="sidebar__item"><a href="/guides/generators/controllers/" class="sidebar__link">Controllers</a></li><li class="sidebar__item"><a href="/guides/generators/models/" class="sidebar__link">Models</a></li><li class="sidebar__item"><a href="/guides/generators/migrations/" class="sidebar__link">Migrations</a></li><li class="sidebar__item"><a href="/guides/generators/mailers/" class="sidebar__link">Mailers</a></li><li class="sidebar__item"><a href="/guides/generators/sub-applications/" class="sidebar__link">Sub-Applications</a></li><li class="sidebar__item"><a href="/guides/generators/tiny-skeleton/" class="sidebar__link">Tiny Skeleton</a></li><li class="sidebar__item"><a href="/guides/generators/admin/" class="sidebar__link">Admin</a></li><li class="sidebar__item"><a href="/guides/generators/components/" class="sidebar__link">Components</a></li><li class="sidebar__item"><a href="/guides/generators/tasks/" class="sidebar__link">Tasks</a></li></ul><h5 class="sidebar__header"><a href="/guides/controllers/overview/">Controllers</a></h5><ul class="sidebar__items"><li class="sidebar__item"><a href="/guides/controllers/overview/" class="sidebar__link">Overview</a></li><li class="sidebar__item"><a href="/guides/controllers/routing/" class="sidebar__link">Routing</a></li><li class="sidebar__item"><a href="/guides/controllers/layouts/" class="sidebar__link">Layouts</a></li><li class="sidebar__item"><a href="/guides/controllers/provides-formats/" class="sidebar__link">Provides Format</a></li><li class="sidebar__item"><a href="/guides/controllers/params-whitelisting/" class="sidebar__link">Params Whitelisting</a></li><li class="sidebar__item"><a href="/guides/controllers/route-filters/" class="sidebar__link">Route Filters</a></li><li class="sidebar__item"><a href="/guides/controllers/prioritized-routes/" class="sidebar__link">Prioritized Routes</a></li><li class="sidebar__item"><a href="/guides/controllers/custom-conditions/" class="sidebar__link">Custom Conditions</a></li><li class="sidebar__item"><a href="/guides/controllers/parsing-params/" class="sidebar__link">Parsing Params</a></li><li class="sidebar__item"><a href="/guides/controllers/rendering/" class="sidebar__link">Rendering</a></li><li class="sidebar__item"><a href="/guides/controllers/sessions/" class="sidebar__link">Sessions</a></li></ul><h5 class="sidebar__header"><a href="/guides/application-helpers/overview/">Application Helpers</a></h5><ul class="sidebar__items"><li class="sidebar__item"><a href="/guides/application-helpers/overview/" class="sidebar__link">Overview</a></li><li class="sidebar__item"><a href="/guides/application-helpers/output-helpers/" class="sidebar__link">Output Helpers</a></li><li class="sidebar__item"><a href="/guides/application-helpers/tag-helpers/" class="sidebar__link">Tag Helpers</a></li><li class="sidebar__item"><a href="/guides/application-helpers/asset-helpers/" class="sidebar__link">Asset Helpers</a></li><li class="sidebar__item"><a href="/guides/application-helpers/form-helpers/" class="sidebar__link">Form Helpers</a></li><li class="sidebar__item"><a href="/guides/application-helpers/form-builders/" class="sidebar__link">Form Builders</a></li><li class="sidebar__item"><a href="/guides/application-helpers/standard-form-builder/" class="sidebar__link">Standard Form Builder</a></li><li class="sidebar__item"><a href="/guides/application-helpers/custom-form-builders/" class="sidebar__link">Custom Form Builders</a></li><li class="sidebar__item"><a href="/guides/application-helpers/nested-object-form-support/" class="sidebar__link">Nested Object Form Support</a></li><li class="sidebar__item"><a href="/guides/application-helpers/format-helpers/" class="sidebar__link">Format Helpers</a></li><li class="sidebar__item"><a href="/guides/application-helpers/render-helpers/" class="sidebar__link">Render Helpers</a></li><li class="sidebar__item"><a href="/guides/application-helpers/custom-helpers/" class="sidebar__link">Custom Helpers</a></li><li class="sidebar__item"><a href="/guides/application-helpers/ujs-helpers/" class="sidebar__link">Unobtrusive JavaScript Helpers</a></li></ul><h5 class="sidebar__header"><a href="/guides/adding-components/overview/">Adding Components</a></h5><ul class="sidebar__items"><li class="sidebar__item"><a href="/guides/adding-components/overview/" class="sidebar__link">Overview</a></li><li class="sidebar__item"><a href="/guides/adding-components/persistence-engine/" class="sidebar__link">Persistence Engine</a></li><li class="sidebar__item"><a href="/guides/adding-components/javascript-engine/" class="sidebar__link">JavaScript Engine</a></li><li class="sidebar__item"><a href="/guides/adding-components/testing-library/" class="sidebar__link">Testing Library</a></li><li class="sidebar__item"><a href="/guides/adding-components/rendering-engine/" class="sidebar__link">Rendering Engine</a></li><li class="sidebar__item"><a href="/guides/adding-components/mocking-library/" class="sidebar__link">Mocking Library</a></li><li class="sidebar__item"><a href="/guides/adding-components/stylesheet-engine/" class="sidebar__link">Stylesheet Engine</a></li><li class="sidebar__item"><a href="/guides/adding-components/locale-translations/" class="sidebar__link">Locale Translations</a></li></ul><h5 class="sidebar__header"><a href="/guides/advanced-usage/overview/">Advanced Usage</a></h5><ul class="sidebar__items"><li class="sidebar__item"><a href="/guides/advanced-usage/overview/" class="sidebar__link">Overview</a></li><li class="sidebar__item"><a href="/guides/advanced-usage/extending-padrino-projects/" class="sidebar__link">Extending Padrino Projects</a></li><li class="sidebar__item"><a href="/guides/advanced-usage/3rd-party-plugins/" class="sidebar__link">3rd Party Plugins</a></li><li class="sidebar__item"><a href="/guides/advanced-usage/asynchronous-concurrency-with-padrino/" class="sidebar__link">Asyncronous Concurrency</a></li><li class="sidebar__item"><a href="/guides/advanced-usage/grape-with-padrino/" class="sidebar__link">Grape with Padrino</a></li><li class="sidebar__item"><a href="/guides/advanced-usage/running-padrino-on-jruby/" class="sidebar__link">Running Padrino on JRuby</a></li><li class="sidebar__item"><a href="/guides/advanced-usage/standalone-usage-in-sinatra/" class="sidebar__link">Standalone Usage in Sinatra</a></li><li class="sidebar__item"><a href="/guides/advanced-usage/padrino-and-omniauth-overview/" class="sidebar__link">Padrino and OmniAuth Overview</a></li></ul></div></div><div class="page__content"><div class="content"><p class="content__chapter-title">Features</p><h1 id="padrino-cache">Padrino Cache</h1>
<p>This component enables caching of an application&#39;s response contents on both
page- and fragment-levels. Output cached in this manner is persisted, until it
expires or is actively expired, in a configurable store of your choosing. Most
popular key/value stores work out of the box. Take a look at the <a href="http://rubydoc.info/gems/moneta">Moneta
documentation</a> for a list of all supported
stores.</p>
<h2 id="caching-quickstart">Caching Quickstart</h2>
<p>Padrino-cache can reduce the processing load on your site very effectively
with minimal configuration.</p>

<p>By default, the component caches pages in a file store at <code>tmp/cache</code> within
your project root. Entries in this store correspond directly to the request
issued to your server. In other words, responses are cached based on request
URL, with one cache entry per URL.</p>

<p>This behavior is referred to as &quot;page-level caching.&quot; If this strategy meets
your needs, you can enable it very easily:</p>
<div class="highlight"><pre class="syntax plaintext"><code># Page-level caching
class SimpleApp &lt; Padrino::Application
  register Padrino::Cache
  enable :caching

  get '/foo', :cache =&gt; true do
    expires 30 # expire cached version at least every 30 seconds
    'Hello world'
  end
end
</code></pre></div>
<p>You can also cache on a controller-wide basis:</p>
<div class="highlight"><pre class="syntax plaintext"><code># Controller-wide caching example
class SimpleApp &lt; Padrino::Application
  register Padrino::Cache
  enable :caching

  get '/' do
    'Hello world'
  end

  # Requests to routes within '/admin'
  controller '/admin', :cache =&gt; true do
    expires 60

    get '/foo' do
      'Url is /admin/foo'
    end

    get '/bar' do
      'Url is /admin/bar'
    end

    post '/baz' do # We cache only GET and HEAD request
      'This will not be cached'
    end
  end
end
</code></pre></div>
<p>You can also provide a custom <code>cache_key</code> in any route:</p>
<div class="highlight"><pre class="syntax plaintext"><code>class SimpleApp &lt; Padrino::Application
  register Padrino::Cache
  enable :caching

  get '/post/:id', :cache =&gt; true do
    @post = Post.find(params[:id])
    cache_key :my_name
  end
end
</code></pre></div>
<p>In this way you can manually expire cache with
CachedApp.cache.delete(:my_name) for example from the Post model after an
update.</p>

<p>If you specify <code>:cache =&gt; true</code> but do not invoke <code>expires</code>, the response will
be cached indefinitely. Most of the time, you will want to specify the expiry
of a cache entry by <code>expires</code>. Even a relatively low value--1 or 2
seconds--can greatly increase application efficiency, especially when enabled
on a very active part of your domain.</p>
<h2 id="helpers">Helpers</h2>
<p>When an application registers padrino-cache, it gains access to several helper
methods. These methods are used according to your caching strategy, so they
are explained here likewise--by functionality.</p>

<p>As with all code optimization, you may want to start simply (at &quot;page level&quot;),
and continue if necessary into sub-page (or &quot;fragment level&quot; ) caching. There
is no one way to approach caching, but it&#39;s always good to avoid complexity
until you need it. Start at the page level and see if it works for you.</p>

<p>The padrino-cache helpers are made available to your application thusly:</p>
<div class="highlight"><pre class="syntax plaintext"><code># Enable caching
class CachedApp &lt; Padrino::Application
  register Padrino::Cache  # includes helpers
  enable :caching          # turns on caching

  # ... controllers/routes ...
end
</code></pre></div><h3 id="page-caching">Page Caching</h3>
<p>As described above in the &quot;Caching Quickstart&quot; section, page caching is very
easy to integrate into your application. To turn it on, simply provide the
<code>:cache =&gt; true</code> option on either a controller or one of its routes. By
default, cached content is persisted with a &quot;file store&quot;--that is, in a
subdirectory of your application root.</p>
<h4 id="code-expires-seconds-code"><code>expires( seconds )</code></h4>
<p>This helper is used within a controller or route to indicate how often cached
<em>page-level</em> content should persist in the cache.</p>

<p>After <code>seconds</code> seconds have passed, content previously cached will be
discarded and re-rendered. Code associated with that route will <em>not</em> be
executed; rather, its previous output will be sent to the client with a 200 OK
status code.</p>
<div class="highlight"><pre class="syntax plaintext"><code># Setting content expiry time
class CachedApp &lt; Padrino::Application
  register Padrino::Cache  # includes helpers
  enable :caching          # turns on caching

  controller '/blog', :cache =&gt; true do
    expires 15

    get '/entries' do
      'just broke up eating twinkies lol'
    end
  end
end
</code></pre></div>
<p>Note that the &quot;latest&quot; method call to <code>expires</code> determines its value: if
called within a route, as opposed to a controller definition, the route&#39;s
value will be assumed.</p>
<h3 id="fragment-caching">Fragment Caching</h3>
<p>Whereas page-level caching, described in the first section of this document,
works by grabbing the entire output of a route, fragment caching gives the
developer fine-grained control of what gets cached. This type of caching
occurs at whatever level you choose.</p>

<p>Possible uses for fragment caching might include:</p>

<ul>
<li>  a &#39;feed&#39; of some items on a page</li>
<li>  output fetched (by proxy) from an API on a third-party site</li>
<li>  parts of your page which are largely static/do not need re-rendering every
request</li>
<li>  any output which is expensive to render</li>
</ul>
<h4 id="code-cache-key-opts-amp-block-code"><code>cache( key, opts, &amp;block )</code></h4>
<p>This helper is used anywhere in your application you would like to associate a
fragment to be cached. It can be used in within a route:</p>
<div class="highlight"><pre class="syntax plaintext"><code># Caching a fragment
class MyTweets &lt; Padrino::Application
  register Padrino::Cache  # includes helpers
  enable :caching          # turns on caching

  controller '/tweets' do
    get :feed, :map =&gt; '/:username' do
      username = params[:username]

      @feed = cache( "feed_for_#{username}", :expires =&gt; 3 ) do
        @tweets = Tweet.all( :username =&gt; username )
        render 'partials/feedcontent'
      end

      # Below outputs @feed somewhere in its markup
      render 'feeds/show'
    end
  end
end
</code></pre></div>
<p>This example adds a key to the cache of format <code>feed_for_#{username}</code> which
contains the contents of that user&#39;s feed. Any subsequent action within the
next 3 seconds will fetch the pre-rendered version of <code>feed_for_#{username}</code>
from the cache instead of re-rendering it. The rest of the page code will,
however, be re-executed.</p>

<p>Note that any other action will reference the same content if it uses the same
key:</p>
<div class="highlight"><pre class="syntax plaintext"><code># Multiple routes sharing the same cached fragment
class MyTweets &lt; Padrino::Application
  register Padrino::Cache  # includes helpers
  enable :caching          # turns on caching

  controller :tweets do
    get :feed, :map =&gt; '/:username' do
      username = params[:username]

      @feed = cache( "feed_for_#{username}", :expires =&gt; 3 ) do
        @tweets = Tweet.all( :username =&gt; username )
        render 'partials/feedcontent'
      end

      # Below outputs @feed somewhere in its markup
      render 'feeds/show'
    end

    get :mobile_feed, :map =&gt; '/:username.iphone' do
      username = params[:username]

      @feed = cache( "feed_for_#{username}", :expires =&gt; 3 ) do
        @tweets = Tweet.all( :username =&gt; username )
        render 'partials/feedcontent'
      end

      render 'feeds/show.iphone'
    end
  end
end
</code></pre></div>
<p>The <code>opts</code> argument is actually passed to the underlying store. The stores
support the <code>:expires</code> option out of the box or are enhanced by Moneta to
support it.</p>

<p>Finally, to DRY up things a bit, we might do:</p>
<div class="highlight"><pre class="syntax plaintext"><code># Multiple routes sharing the same cached fragment
class MyTweets &lt; Padrino::Application
  register Padrino::Cache  # includes helpers
  enable :caching          # turns on caching

  controller :tweets do
    # This works because all routes in this controller specify :username
    before do
      @feed = cache( "feed_for_#{params[:username]}", :expires =&gt; 3 ) do
        @tweets = Tweet.all( :username =&gt; params[:username] )
        render 'partials/feedcontent'
      end
    end

    get :feed, :map =&gt; '/:username' do
      render 'feeds/show'
    end

    get :mobile_feed, :map =&gt; '/:username.iphone' do
      render 'feeds/show.iphone'
    end
  end
end
</code></pre></div>
<p>Of course, this example assumes the markup generated by rendering
<code>partials/feedcontent</code> would be suitable for both feed formats. This may or
may not be the case in your application, but the principle applies: fragments
are shared between all code which accesses the cache using the same key.</p>
<h3 id="caching-urls-with-query-strings">Caching URLs with query strings</h3>
<p>Another use of cache<em>key is when youâ€™d like to include query string parameters
as part of the key; for example when using `will</em>paginate<code>, you might want to
cache</code>url?page=1<code>separately from</code>url?page=2`:</p>
<div class="highlight"><pre class="syntax plaintext"><code>cache_key { request.path_info + (params[:page].present? ? "?page=#{params[:page]}" : '') }
</code></pre></div>
<p>If you&#39;re using <code>ActiveSupport</code>, you can make this a bit more robust:</p>
<div class="highlight"><pre class="syntax plaintext"><code>cache_key { request.path_info + '?' + params.slice('page').to_param }
</code></pre></div><h2 id="caching-store">Caching Store</h2>
<p>You can set a global caching option or a per app caching options.</p>
<h3 id="global-caching-options">Global Caching Options</h3><div class="highlight"><pre class="syntax plaintext"><code>Padrino.cache = Padrino::Cache.new(:LRUHash) # in-memory, the default choice
Padrino.cache = Padrino::Cache.new(:File, :dir =&gt; Padrino.root('tmp', app_name.to_s, 'cache')) # Keeps cached values in file
Padrino.cache = Padrino::Cache.new(:Memcached) # Uses default server at localhost
Padrino.cache = Padrino::Cache.new(:Memcached, :server =&gt; '127.0.0.1:11211', :exception_retry_limit =&gt; 1)
Padrino.cache = Padrino::Cache.new(:Memcached, :backend =&gt; memcached_or_dalli_instance)
Padrino.cache = Padrino::Cache.new(:Redis) # Uses default server at localhost
Padrino.cache = Padrino::Cache.new(:Redis, :host =&gt; '127.0.0.1', :port =&gt; 6379, :db =&gt; 0)
Padrino.cache = Padrino::Cache.new(:Redis, :backend =&gt; redis_instance)
Padrino.cache = Padrino::Cache.new(:Mongo) # Uses default server at localhost
Padrino.cache = Padrino::Cache.new(:Mongo, :backend =&gt; mongo_client_instance)
</code></pre></div>
<p>You can manage your cache from anywhere in your app:</p>
<div class="highlight"><pre class="syntax plaintext"><code>Padrino.cache['val'] = 'test'
Padrino.cache['val'] # =&gt; 'test'
Padrino.cache.delete('val')
Padrino.cache.clear
</code></pre></div>
<p>The Padrino cache constructor <code>Padrino::Cache.new</code> calls <code>Moneta.new</code> to
create a cache instance. Please refer to the <a href="http://rubydoc.info/gems/moneta">Moneta
documentation</a> if you have special
requirements, for example if you want to configure the marshalling mechanism
or use a more exotic backend.</p>
<h3 id="application-caching-options">Application Caching Options</h3><div class="highlight"><pre class="syntax plaintext"><code>set :cache, Padrino::Cache.new(:LRUHash) # in-memory
set :cache, Padrino::Cache.new(:Memcached)
set :cache, Padrino::Cache.new(:Redis)
set :cache, Padrino::Cache.new(:File, :dir =&gt; Padrino.root('tmp', app_name.to_s, 'cache')) # default choice
</code></pre></div>
<p>You can manage your cache from anywhere in your app:</p>
<div class="highlight"><pre class="syntax plaintext"><code>MyApp.cache['val'] = 'test'
MyApp.cache['val'] # =&gt; 'test'
MyApp.cache.delete('val')
MyApp.cache.clear
</code></pre></div><h2 id="expiring-cached-content">Expiring Cached Content</h2>
<p>In certain circumstances, cached content becomes stale. The  <code>expire</code> helper
removes content associated with a key or keys, which your app is then free to
re-generate.</p>
<h3 id="code-expire-key-code"><code>expire( *key )</code></h3><h4 id="fragment-level-expiration">Fragment-level expiration</h4>
<p>Using the example above of a tweet server, let&#39;s suppose our users have a
tendency to post things they quickly regret. When we query our database for
new tweets, let&#39;s check to see if any have been deleted. If so, we&#39;ll do our
user a favor and instantly re-render the feed.</p>
<div class="highlight"><pre class="syntax plaintext"><code># Expiring fragment-level cached content
class MyTweets &lt; Padrino::Application
  register Padrino::Cache # includes helpers
  enable :caching         # turns on caching
  enable :session         # we'll use this to store last time visited

  COMPANY_FOUNDING = Time.utc( 2010, "April" )

  controller :tweets do
    get :feed, :map =&gt; '/:username' do
      last_visit = session[:last_visit] || params[:since] || COMPANY_FOUNDING

      username = params[:username]
      @tweets = Tweet.since( last_visit, :username =&gt; username ).limit( 100 )

      expire( "feed since #{last_visit}" ) if @tweets.any? { |t| t.deleted_since?( last_visit ) }

      session[:last_visit] = Time.now
      @feed = cache( "feed since #{last_visit}", :expires =&gt; 60 ) do
        @tweets = @tweets.find_all { |t| !t.deleted? }
        render 'partials/feedcontent'
      end

      render 'feeds/show'
    end
  end
end
</code></pre></div>
<p>Normally, this example will only re-cache feed content every 60 seconds, but
it will do so immediately if any tweets have been deleted.</p>
<h4 id="page-level-expiration">Page-level expiration</h4>
<p>Page-level expiration works exactly like the example above--by using <code>expire</code>
in your controller. The key is typically <code>env[&#39;PATH_INFO&#39;]</code>.</p>
<p class="updated"> last updated: 2022-03-01</p><div id='disqus_thread'></div>
<script type='text/javascript'>
//<![CDATA[
                  var disqus_shortname = 'padrinorb';
          
    (function() {
      if (typeof(DISQUS) === 'undefined') {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      } else {
        DISQUS.reset({
          reload: true,
          config: function () {
            this.page.identifier = document.title;
            this.page.url = location.href;
          }
        });
      }
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript>
<a href='http://disqus.com' class='dsq-brlink'>comments powered by <span class='logo-disqus'>Disqus</span></a>
</div></div></div><hr /><footer class="footer"><p>Padrino is released under the MIT LICENSE<br/>
Hosting by <a href="https://pages.github.com" title="GitHub Pages">GitHub Pages</a><br/>
Logo design by <a href="https://www.unpolo.com/" title="unpolo">unpolo</a></p>
<script>anchors.add('').remove('.sidebar h4, .sidebar h5, .header h1');
  ((window.gitter = {}).chat = {}).options = {
    room: 'padrino/padrino-framework'
  };</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script></footer></div></body></html>